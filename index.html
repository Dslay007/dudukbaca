<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duduk Baca | Komunitas Literasi Malang</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for beautiful, modern icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Mengatur font Inter sebagai default */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfbf9; /* Latar belakang krem muda */
        }
        /* Custom scrollbar style */
        .overflow-y-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-scroll::-webkit-scrollbar-thumb {
            background-color: #a7f3d0; /* light teal */
            border-radius: 4px;
        }
        /* Style untuk Green Box Review */
        .review-box {
            background-color: #e0f2f1; /* Green-100 for light background */
            border-left: 5px solid #14b8a6; /* Teal-500 border */
        }
        /* Style untuk Struktur Anggota */
        .member-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        /* Style untuk Carousel */
        .carousel-item {
            display: none;
            transition: opacity 0.5s ease-in-out;
        }
        .carousel-item.active {
            display: block;
            opacity: 1;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-teal-600 tracking-wider">DUDUK BACA</span>
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:space-x-4 items-center">
                    <a href="#beranda" class="text-gray-900 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Beranda</a>
                    <a href="#tentang" class="text-gray-900 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Tentang Kami</a>
                    <a href="#struktur" class="text-gray-900 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Struktur Komunitas</a>
                    <a href="#bukudigital" class="text-gray-900 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Buku Digital (API)</a>
                    <a href="#koleksi" class="text-gray-900 hover:text-teal-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Koleksi Komunitas</a>
                    <a href="#keanggotaan" class="text-white bg-teal-600 hover:bg-teal-700 px-3 py-2 rounded-full text-sm font-medium shadow-md transition duration-150 ease-in-out">Daftar / Login</a>
                    <a id="linktree-link" href="#" target="_blank" class="text-gray-500 hover:text-teal-600 p-2 rounded-full transition duration-150 ease-in-out" title="Linktree"><i data-lucide="link"></i></a>
                    <a id="sosmed-link" href="#" target="_blank" class="text-gray-500 hover:text-teal-600 p-2 rounded-full transition duration-150 ease-in-out" title="Instagram/Sosmed"><i data-lucide="instagram"></i></a>
                </div>
                <button id="menu-button" class="sm:hidden text-gray-500 hover:text-teal-600 focus:outline-none p-2 transition duration-150 ease-in-out"><i data-lucide="menu"></i></button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden sm:hidden px-2 pt-2 pb-3 space-y-1 bg-white border-t">
            <a href="#beranda" class="text-gray-900 hover:bg-teal-50 hover:text-teal-600 block px-3 py-2 rounded-md text-base font-medium">Beranda</a>
            <a href="#tentang" class="text-gray-900 hover:bg-teal-50 hover:text-teal-600 block px-3 py-2 rounded-md text-base font-medium">Tentang Kami</a>
            <a href="#struktur" class="text-gray-900 hover:bg-teal-50 hover:text-teal-600 block px-3 py-2 rounded-md text-base font-medium">Struktur Komunitas</a>
            <a href="#bukudigital" class="text-gray-900 hover:bg-teal-50 hover:text-teal-600 block px-3 py-2 rounded-md text-base font-medium">Buku Digital (API)</a>
            <a href="#koleksi" class="text-gray-900 hover:bg-teal-50 hover:text-teal-600 block px-3 py-2 rounded-md text-base font-medium">Koleksi Komunitas</a>
            <a href="#keanggotaan" class="text-white bg-teal-600 hover:bg-teal-700 block px-3 py-2 rounded-md text-base font-medium">Daftar / Login</a>
            <div class="flex space-x-4 p-2">
                <a id="mobile-linktree-link" href="#" target="_blank" class="text-gray-500 hover:text-teal-600" title="Linktree"><i data-lucide="link"></i></a>
                <a id="mobile-sosmed-link" href="#" target="_blank" class="text-gray-500 hover:text-teal-600" title="Instagram/Sosmed"><i data-lucide="instagram"></i></a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Notifikasi (Modal) -->
        <div id="notification-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-[100]">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3 text-center">
                    <div id="modal-icon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                        <i data-lucide="check-circle" class="text-green-600 h-6 w-6"></i>
                    </div>
                    <h3 id="modal-title" class="text-lg leading-6 font-medium text-gray-900 mt-2">Sukses!</h3>
                    <div class="mt-2 px-7 py-3">
                        <p id="modal-message" class="text-sm text-gray-500">Operasi berhasil dilakukan.</p>
                    </div>
                    <div class="items-center px-4 py-3">
                        <button id="modal-close-button" class="px-4 py-2 bg-teal-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500">
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 1. Beranda / Dashboard (Mengambil inspirasi layout bank) -->
        <section id="beranda" class="mb-16">
            <h1 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Dashboard Komunitas</h1>

            <!-- Top Banner/Hero Section (mengambil konsep group photo) -->
            <div class="relative bg-gray-100 rounded-xl overflow-hidden shadow-xl mb-12">
                <img src="https://placehold.co/1200x300/e0f2f1/14b8a6?text=Foto+Bersama+Keluarga+Duduk+Baca" alt="Foto Bersama Komunitas Duduk Baca" class="w-full h-48 object-cover md:h-64">
                <div class="absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent"></div>
                <div class="absolute bottom-0 left-0 p-6 md:p-8">
                    <p class="text-base font-semibold text-white/80">Selamat datang di</p>
                    <h2 class="text-3xl md:text-5xl font-extrabold text-white leading-tight">DUDUK BACA</h2>
                    <p class="text-white/90 mt-1 md:text-lg">Komunitas Literasi & Lapak Baca Malang</p>
                    <div class="mt-4 flex flex-wrap gap-3">
                        <button onclick="showSection('tentang')" class="px-4 py-2 bg-teal-500 text-white font-semibold rounded-full shadow-lg hover:bg-teal-600 transition duration-300">
                            Kenali Kami <i data-lucide="arrow-right" class="w-4 h-4 inline ml-1"></i>
                        </button>
                        <a href="#" target="_blank" class="px-4 py-2 bg-yellow-500 text-gray-900 font-semibold rounded-full shadow-lg hover:bg-yellow-600 transition duration-300">
                            Kedai Dubi (Merchandise) <i data-lucide="shopping-cart" class="w-4 h-4 inline ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Dashboard Cards (Visi Misi & Stats) -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Card 1: Visi & Misi -->
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg border border-teal-100">
                    <h3 class="text-2xl font-bold text-teal-600 mb-4 flex items-center"><i data-lucide="eye" class="w-6 h-6 mr-2"></i> Visi & Misi Kami</h3>
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold text-xl text-gray-800">Visi</p>
                            <p class="text-gray-600">Menyebarluaskan budaya membaca di tempat umum dan meningkatkan minat literasi masyarakat secara berkelanjutan.</p>
                        </div>
                        <div class="pt-2 border-t border-gray-100">
                            <p class="font-semibold text-xl text-gray-800">Misi</p>
                            <ul class="list-disc list-inside text-gray-600 pl-4 space-y-1">
                                <li>Menyediakan akses buku gratis melalui lapak baca mingguan dan koleksi digital.</li>
                                <li>Menciptakan ruang publik yang nyaman dan inklusif untuk diskusi dan kegiatan literasi.</li>
                                <li>Mendokumentasikan dan membagikan rangkuman buku berkualitas secara teratur.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Statistik Peminjaman (Data Real-time dari Firestore) -->
                <div class="bg-teal-600 text-white p-6 rounded-2xl shadow-xl flex flex-col justify-between">
                    <div>
                        <h3 class="text-2xl font-bold mb-3 flex items-center"><i data-lucide="bar-chart-3" class="w-6 h-6 mr-2"></i> Statistik Kami</h3>
                        <p class="text-sm opacity-80">Data real-time dari Koleksi Duduk Baca.</p>
                    </div>
                    <div class="mt-4 space-y-3">
                        <div class="flex justify-between items-center bg-teal-700/70 p-3 rounded-xl">
                            <span class="font-medium">Total Peminjaman:</span>
                            <span id="stat-borrowings" class="text-3xl font-extrabold">...</span>
                        </div>
                        <div class="flex justify-between items-center bg-teal-700/70 p-3 rounded-xl">
                            <span class="font-medium">Total Bacawan Terdaftar:</span>
                            <span id="stat-members" class="text-3xl font-extrabold">...</span>
                        </div>
                        <!-- Perbaikan: Mengganti Acara Terlaksana ke Total Koleksi Buku Fisik -->
                        <div class="flex justify-between items-center bg-teal-700/70 p-3 rounded-xl">
                            <span class="font-medium">Total Koleksi Buku Fisik:</span>
                            <span id="stat-books" class="text-3xl font-extrabold">...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agenda Events Section -->
            <div class="mt-12">
                <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center"><i data-lucide="calendar-days" class="w-6 h-6 mr-2 text-teal-600"></i> Agenda Komunitas</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Agenda Mendatang -->
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-500">
                        <h4 class="text-xl font-bold text-blue-600 mb-4 flex items-center"><i data-lucide="calendar-check" class="w-5 h-5 mr-2"></i> Agenda Mendatang</h4>
                        <div id="agenda-mendatang" class="space-y-4 text-gray-700 overflow-y-scroll max-h-96">
                            <!-- Data will be loaded here -->
                             <p class="text-gray-500">Memuat agenda...</p>
                        </div>
                    </div>
                    <!-- Agenda Sudah Berlalu -->
                    <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-gray-500">
                        <h4 class="text-xl font-bold text-gray-600 mb-4 flex items-center"><i data-lucide="history" class="w-5 h-5 mr-2"></i> Agenda Sudah Berlalu</h4>
                        <div id="agenda-berlalu" class="space-y-4 text-gray-700 overflow-y-scroll max-h-96">
                            <!-- Data will be loaded here -->
                             <p class="text-gray-500">Memuat agenda...</p>
                        </div>
                    </div>
                </div>
            </div>

        </section>
        
        <!-- 2. Tentang Kami (Apa itu Duduk Baca) -->
        <section id="tentang" class="mb-16 hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Tentang Duduk Baca</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
                <div>
                    <h3 class="text-2xl font-bold text-teal-600 mb-4">Filosofi Kami</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Duduk Baca adalah sebuah gerakan komunitas literasi yang berpusat di Malang. Kami percaya bahwa membaca adalah hak semua orang dan harus dapat diakses di ruang publik. "Duduk Baca" bukan hanya tentang membaca buku, tetapi tentang menciptakan momen tenang ("Duduk") di tengah hiruk pikuk kehidupan, untuk meresapi pengetahuan ("Baca").
                    </p>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Kami secara rutin mengadakan **Lapak Baca Mingguan** di Alun-Alun Kota Malang setiap hari Minggu, di mana siapa pun, dari segala usia, dapat datang, duduk, dan membaca buku-buku koleksi kami secara gratis.
                    </p>
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
                        <p class="font-semibold text-yellow-800">Kami menyebut para penggemar dan peminjam buku kami sebagai <span class="text-xl font-extrabold">"BACAWAN"</span>.</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-teal-600 mb-4">Kegiatan Utama</h3>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <i data-lucide="book-open-check" class="w-6 h-6 text-teal-500 mt-1 mr-3 flex-shrink-0"></i>
                            <p class="text-gray-700"><span class="font-bold">Lapak Baca Publik:</span> Rutinitas setiap hari Minggu di Alun-Alun Malang, menyediakan ratusan buku siap baca di tempat.</p>
                        </li>
                        <li class="flex items-start">
                            <i data-lucide="library" class="w-6 h-6 text-teal-500 mt-1 mr-3 flex-shrink-0"></i>
                            <p class="text-gray-700"><span class="font-bold">Koleksi Peminjaman Online:</span> Sistem *booking* buku fisik koleksi pribadi komunitas untuk Bacawan yang sudah terdaftar.</p>
                        </li>
                        <li class="flex items-start">
                            <i data-lucide="pencil" class="w-6 h-6 text-teal-500 mt-1 mr-3 flex-shrink-0"></i>
                            <p class="text-gray-700"><span class="font-bold">Review dan Rangkuman Buku:</span> Konten eksklusif berupa rangkuman buku yang ditulis manual oleh anggota komunitas kami.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 2.5 Struktur Komunitas -->
        <section id="struktur" class="mb-16 hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Struktur Komunitas Duduk Baca</h2>

            <!-- Founder Section -->
            <h3 class="text-2xl font-bold text-teal-600 mb-6 flex items-center"><i data-lucide="award" class="w-6 h-6 mr-2"></i> Founder (4 Orang)</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
                <!-- Mock Founder Cards -->
                <div class="member-card bg-white p-4 rounded-xl text-center">
                    <img src="https://placehold.co/100x100/14b8a6/ffffff?text=F1" alt="Founder 1" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-teal-200">
                    <p class="font-bold text-gray-800">Founder 1</p>
                    <p class="text-sm text-teal-600">Visioner</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center">
                    <img src="https://placehold.co/100x100/14b8a6/ffffff?text=F2" alt="Founder 2" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-teal-200">
                    <p class="font-bold text-gray-800">Founder 2</p>
                    <p class="text-sm text-teal-600">Strategis</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center">
                    <img src="https://placehold.co/100x100/14b8a6/ffffff?text=F3" alt="Founder 3" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-teal-200">
                    <p class="font-bold text-gray-800">Founder 3</p>
                    <p class="text-sm text-teal-600">Kreatif</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center">
                    <img src="https://placehold.co/100x100/14b8a6/ffffff?text=F4" alt="Founder 4" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-teal-200">
                    <p class="font-bold text-gray-800">Founder 4</p>
                    <p class="text-sm text-teal-600">Teknis</p>
                </div>
            </div>

            <!-- Inti Section -->
            <h3 class="text-2xl font-bold text-teal-600 mb-6 flex items-center"><i data-lucide="users" class="w-6 h-6 mr-2"></i> Anggota Inti (Ketua, Wakil, Sekre, Benda)</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
                <!-- Mock Inti Cards -->
                <div class="member-card bg-white p-4 rounded-xl text-center border border-blue-100">
                    <img src="https://placehold.co/100x100/3b82f6/ffffff?text=KETUA" alt="Ketua" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-blue-400">
                    <p class="font-bold text-gray-800">Nama Ketua</p>
                    <p class="text-sm text-blue-600">Ketua Umum</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-blue-100">
                    <img src="https://placehold.co/100x100/3b82f6/ffffff?text=WAKIL" alt="Wakil Ketua" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-blue-400">
                    <p class="font-bold text-gray-800">Nama Wakil</p>
                    <p class="text-sm text-blue-600">Wakil Ketua</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-blue-100">
                    <img src="https://placehold.co/100x100/3b82f6/ffffff?text=SEKRE" alt="Sekretaris" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-blue-400">
                    <p class="font-bold text-gray-800">Nama Sekretaris</p>
                    <p class="text-sm text-blue-600">Sekretaris</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-blue-100">
                    <img src="https://placehold.co/100x100/3b82f6/ffffff?text=BEND" alt="Bendahara" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-4 border-blue-400">
                    <p class="font-bold text-gray-800">Nama Bendahara</p>
                    <p class="text-sm text-blue-600">Bendahara</p>
                </div>
            </div>

            <!-- Divisi Section -->
            <h3 class="text-2xl font-bold text-teal-600 mb-6 flex items-center"><i data-lucide="briefcase" class="w-6 h-6 mr-2"></i> Divisi (6 Divisi)</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                <!-- Mock Divisi Cards -->
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="megaphone" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Event & Collaboration</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="video" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Content Creator</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="settings-2" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Internal</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="instagram" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Social Media</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="wallet" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Finance</p>
                </div>
                <div class="member-card bg-white p-4 rounded-xl text-center border border-teal-100">
                    <i data-lucide="book-check" class="w-8 h-8 text-teal-500 mx-auto mb-2"></i>
                    <p class="font-bold text-gray-800">Administrasi Buku</p>
                </div>
            </div>
        </section>

        <!-- 3. Buku Digital (API Integration Mockup) -->
        <section id="bukudigital" class="mb-16 hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Katalog Buku Digital (Integrasi API)</h2>
            <p class="text-gray-600 mb-6">Kami telah mengintegrasikan API dari beberapa penyedia buku digital. Jelajahi ribuan e-book langsung dari sini!</p>
            
            <div id="digital-books-list" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                <!-- Placeholder untuk hasil API -->
                <div class="bg-white p-4 rounded-xl shadow-md text-center">
                    <i data-lucide="cloud-download" class="w-10 h-10 mx-auto mb-2 text-teal-500"></i>
                    <p class="font-semibold">Buku Digital 1</p>
                    <p class="text-sm text-gray-500">API Source A</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-md text-center">
                    <i data-lucide="cloud-download" class="w-10 h-10 mx-auto mb-2 text-teal-500"></i>
                    <p class="font-semibold">Buku Digital 2</p>
                    <p class="text-sm text-gray-500">API Source B</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-md text-center">
                    <i data-lucide="cloud-download" class="w-10 h-10 mx-auto mb-2 text-teal-500"></i>
                    <p class="font-semibold">Buku Digital 3</p>
                    <p class="text-sm text-gray-500">API Source C</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-md text-center col-span-full">
                    <button onclick="fetchDigitalBooks()" class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-lg hover:bg-teal-600 transition duration-300">
                        Tampilkan Lebih Banyak Buku Digital
                    </button>
                </div>
            </div>
        </section>

        <!-- 4. Koleksi Duduk Baca (Peminjaman Fisik) -->
        <section id="koleksi" class="mb-16 hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Koleksi Peminjaman Komunitas</h2>
            
            <!-- Statistic Card for Physical Books - Menggunakan ID lama (stat-books) yang kini sudah ada di Dashboard -->
            <div class="bg-teal-50 border border-teal-200 p-6 rounded-2xl shadow-md mb-8 flex items-center justify-between">
                <div class="flex items-center">
                    <i data-lucide="book-open-text" class="w-10 h-10 text-teal-600 mr-4"></i>
                    <div>
                        <p class="text-xl font-medium text-gray-700">Total Koleksi Buku Fisik yang Tersedia:</p>
                        <p class="text-sm text-teal-700">Dikelola oleh Divisi Administrasi Buku</p>
                    </div>
                </div>
                <span id="stat-books-koleksi" class="text-5xl font-extrabold text-teal-800">...</span>
            </div>

            <p class="text-gray-600 mb-8">Koleksi buku pribadi anggota komunitas. Bacawan yang terdaftar dapat melakukan *booking* online untuk dipinjam.</p>
            
            <div id="physical-books-list" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                <!-- Contoh Buku Koleksi -->
                <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-100 text-center">
                    <img src="https://placehold.co/150x200/f4f1ed/1f2937?text=Cover+Buku" alt="Cover Buku" class="w-full h-auto rounded-lg mb-3">
                    <p class="font-semibold text-gray-800 line-clamp-2">Atomic Habits</p>
                    <p class="text-sm text-gray-500 mb-3">James Clear</p>
                    <button onclick="handleBooking('Atomic Habits')" class="w-full px-3 py-2 bg-blue-500 text-white text-sm font-medium rounded-full hover:bg-blue-600 transition duration-300">
                        Booking Sekarang
                    </button>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-100 text-center">
                    <img src="https://placehold.co/150x200/f4f1ed/1f2937?text=Cover+Buku" alt="Cover Buku" class="w-full h-auto rounded-lg mb-3">
                    <p class="font-semibold text-gray-800 line-clamp-2">Sapiens</p>
                    <p class="text-sm text-gray-500 mb-3">Yuval Noah Harari</p>
                    <button onclick="handleBooking('Sapiens')" class="w-full px-3 py-2 bg-blue-500 text-white text-sm font-medium rounded-full hover:bg-blue-600 transition duration-300">
                        Booking Sekarang
                    </button>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-100 text-center">
                    <img src="https://placehold.co/150x200/f4f1ed/1f2937?text=Cover+Buku" alt="Cover Buku" class="w-full h-auto rounded-lg mb-3">
                    <p class="font-semibold text-gray-800 line-clamp-2">Filosofi Teras</p>
                    <p class="text-sm text-gray-500 mb-3">Henry Manampiring</p>
                    <button onclick="handleBooking('Filosofi Teras')" class="w-full px-3 py-2 bg-blue-500 text-white text-sm font-medium rounded-full hover:bg-blue-600 transition duration-300">
                        Booking Sekarang
                    </button>
                </div>
                <!-- Tambahkan tombol untuk melihat lebih banyak koleksi -->
                <div class="col-span-full text-center mt-6">
                    <button class="px-6 py-3 bg-teal-500 text-white font-semibold rounded-full shadow-lg hover:bg-teal-600 transition duration-300">
                        Jelajahi Semua Koleksi
                    </button>
                </div>
            </div>
            
            <!-- Booking Modal (Hidden by default) -->
            <div id="booking-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full z-[90]">
                <div class="relative top-10 mx-auto p-8 border w-96 shadow-xl rounded-xl bg-white">
                    <h3 class="text-xl font-bold text-teal-600 mb-4">Formulir Booking Buku</h3>
                    <p class="text-gray-600 mb-4">Anda harus Login sebagai Bacawan untuk meminjam. Buku yang akan di-booking:</p>
                    <p id="booking-book-title" class="text-lg font-bold mb-6 text-gray-800"></p>
                    
                    <div id="booking-status-unauthenticated" class="p-4 bg-red-100 text-red-700 rounded-lg">
                        <p class="font-semibold">Anda Belum Terdaftar/Login!</p>
                        <p class="text-sm mt-1">Silakan <a href="#keanggotaan" class="font-bold underline text-red-800" onclick="closeModal('booking-modal')">Daftar/Login</a> terlebih dahulu sebagai Bacawan.</p>
                    </div>

                    <div id="booking-status-authenticated" class="hidden">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-1">Nama Bacawan</label>
                            <input type="text" id="booking-user-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" value="Bacawan John Doe" readonly>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 font-medium mb-1">Tanggal Ambil</label>
                            <input type="date" id="booking-pickup-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                        </div>
                        <button onclick="submitBooking()" class="w-full px-4 py-3 bg-teal-600 text-white font-medium rounded-full shadow-md hover:bg-teal-700 transition duration-300">
                            Konfirmasi Booking
                        </button>
                    </div>

                    <button onclick="closeModal('booking-modal')" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
            </div>
        </section>

        <!-- 5. Keanggotaan (Daftar/Login Bacawan) -->
        <section id="keanggotaan" class="mb-16 hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Keanggotaan Bacawan</h2>
            <p id="auth-status" class="text-lg font-semibold text-gray-700 mb-6">Status: Tidak Terautentikasi</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-12">
                <div id="registration-card" class="bg-white p-8 rounded-2xl shadow-xl border border-teal-100">
                    <h3 class="text-2xl font-bold text-teal-600 mb-4 flex items-center"><i data-lucide="user-plus" class="w-6 h-6 mr-2"></i> Daftar Sebagai Bacawan</h3>
                    <p class="text-gray-600 mb-6">Daftar untuk mendapatkan akses peminjaman koleksi fisik dan info eksklusif.</p>
                    <form id="register-form">
                        <div class="mb-4">
                            <label for="reg-name" class="block text-gray-700 font-medium mb-1">Nama Lengkap</label>
                            <input type="text" id="reg-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="Contoh: John Doe" required>
                        </div>
                        <div class="mb-6">
                            <label for="reg-email" class="block text-gray-700 font-medium mb-1">Email</label>
                            <input type="email" id="reg-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="email@contoh.com" required>
                        </div>
                        <button type="submit" class="w-full px-4 py-3 bg-teal-600 text-white font-bold rounded-full shadow-lg hover:bg-teal-700 transition duration-300">
                            Daftar Sekarang
                        </button>
                    </form>
                </div>

                <div id="login-info-card" class="bg-teal-50 p-8 rounded-2xl shadow-xl border border-teal-200">
                    <h3 class="text-2xl font-bold text-teal-700 mb-4 flex items-center"><i data-lucide="info" class="w-6 h-6 mr-2"></i> Info Autentikasi</h3>
                    <p class="text-teal-700 leading-relaxed">
                        Untuk kebutuhan platform ini, Anda otomatis terautentikasi (Anonymous/Custom Token) saat aplikasi dimuat.
                    </p>
                    <p id="user-id-display" class="mt-4 text-sm font-mono break-all bg-white p-3 rounded-lg shadow-inner">User ID: Memuat...</p>
                    <p class="mt-4 text-sm text-teal-800">
                        Bacawan akan menggunakan ID ini untuk memverifikasi peminjaman koleksi.
                    </p>
                </div>
            </div>
            
            <!-- Tambahan: Volunteer Batch Info -->
            <div class="bg-white p-8 rounded-2xl shadow-xl border border-red-100 mt-10">
                <h3 class="text-2xl font-bold text-red-600 mb-4 flex items-center"><i data-lucide="sparkles" class="w-6 h-6 mr-2"></i> Pendaftaran Volunteer Batch 7 (TUTUP)</h3>
                
                <p class="text-gray-700 mb-4">
                    Terima kasih atas antusiasme yang luar biasa! Pendaftaran **Volunteer Batch 7** telah ditutup pada tanggal **30 September 2025**. Kami sangat menghargai semua pendaftar.
                </p>
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg mb-6">
                    <p class="font-semibold text-yellow-800 flex items-center">
                         <i data-lucide="clock-2" class="w-5 h-5 mr-2"></i>
                         Nantikan informasi pembukaan **Batch 8** selanjutnya. Pantau terus *social media* kami di Instagram (@dudukbaca_mlg) agar tidak ketinggalan!
                    </p>
                </div>

                <!-- Volunteer Highlight Carousel -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Carousel Display -->
                    <div class="relative overflow-hidden rounded-xl shadow-lg h-64 md:h-80 bg-gray-200">
                        <div id="volunteer-carousel" class="w-full h-full">
                            <!-- Carousel items will be injected by JavaScript -->
                        </div>
                        <!-- Navigation Buttons -->
                        <button onclick="changeSlide(-1)" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black/50 p-2 rounded-full text-white hover:bg-black/80 transition z-10">
                            <i data-lucide="chevron-left" class="w-6 h-6"></i>
                        </button>
                        <button onclick="changeSlide(1)" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black/50 p-2 rounded-full text-white hover:bg-black/80 transition z-10">
                            <i data-lucide="chevron-right" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <!-- Benefits List -->
                    <div>
                        <h4 class="text-xl font-bold text-teal-600 mb-3 flex items-center"><i data-lucide="check-circle" class="w-5 h-5 mr-2"></i> Keuntungan Jadi Volunteer</h4>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start">
                                <i data-lucide="sparkles" class="w-5 h-5 text-yellow-500 mt-1 mr-3 flex-shrink-0"></i>
                                <p><span class="font-semibold">Literasi Sosial:</span> Berkontribusi langsung dalam peningkatan minat baca di Malang.</p>
                            </li>
                            <li class="flex items-start">
                                <i data-lucide="network" class="w-5 h-5 text-teal-500 mt-1 mr-3 flex-shrink-0"></i>
                                <p><span class="font-semibold">Relasi Komunitas:</span> Membangun jaringan dengan sesama pegiat literasi dan aktivis.</p>
                            </li>
                            <li class="flex items-start">
                                <i data-lucide="certificate" class="w-5 h-5 text-blue-500 mt-1 mr-3 flex-shrink-0"></i>
                                <p><span class="font-semibold">Sertifikat Resmi:</span> Mendapatkan sertifikat keanggotaan/kontribusi komunitas.</p>
                            </li>
                            <li class="flex items-start">
                                <i data-lucide="handshake" class="w-5 h-5 text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                                <p><span class="font-semibold">Akses Buku Eksklusif:</span> Hak pinjam koleksi pribadi lebih mudah.</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 6. Rangkuman/Review Buku (Green Box) -->
        <section id="reviews" class="mb-16">
            <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl mb-8 border-b pb-2">Rangkuman Buku Pilihan Komunitas</h2>
            <p class="text-gray-600 mb-6">Ringkasan eksklusif yang ditulis manual oleh Bacawan Komunitas Duduk Baca.</p>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Contoh Review 1 (Mengambil inspirasi warna hijau) -->
                <div class="review-box p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold text-gray-800">Sebuah Seni Untuk Bersikap Bodo Amat</h3>
                        <i data-lucide="feather" class="w-6 h-6 text-teal-600 flex-shrink-0"></i>
                    </div>
                    <p class="text-sm font-semibold text-teal-700 mb-3">Oleh: Mark Manson | Dirangkum oleh: Anggota Komunitas A</p>
                    <p class="text-gray-700 line-clamp-6">
                        Buku ini mengajarkan untuk tidak terlalu peduli pada hal-hal kecil yang tidak penting. Fokuskan energi pada apa yang benar-benar bernilai dalam hidup Anda. Kunci dari kebahagiaan sejati adalah memilih perjuangan Anda dan menerima bahwa hidup ini penuh dengan masalahâ€”dan itu tidak apa-apa.
                    </p>
                    <button class="mt-4 text-teal-600 font-semibold hover:underline">Baca Selengkapnya</button>
                </div>
                
                <!-- Contoh Review 2 -->
                <div class="review-box p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold text-gray-800">The Psychology of Money</h3>
                        <i data-lucide="feather" class="w-6 h-6 text-teal-600 flex-shrink-0"></i>
                    </div>
                    <p class="text-sm font-semibold text-teal-700 mb-3">Oleh: Morgan Housel | Dirangkum oleh: Anggota Komunitas B</p>
                    <p class="text-gray-700 line-clamp-6">
                        Buku ini membahas bahwa kesuksesan finansial lebih banyak ditentukan oleh perilaku daripada kecerdasan. Konsep seperti menabung, berpikir jangka panjang, dan menghindari keserakahan dibahas dalam cerita pendek yang menarik dan mudah dipahami.
                    </p>
                    <button class="mt-4 text-teal-600 font-semibold hover:underline">Baca Selengkapnya</button>
                </div>

                <!-- Contoh Review 3 -->
                <div class="review-box p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold text-gray-800">Duduk Dulu</h3>
                        <i data-lucide="feather" class="w-6 h-6 text-teal-600 flex-shrink-0"></i>
                    </div>
                    <p class="text-sm font-semibold text-teal-700 mb-3">Oleh: Franco Mendey | Dirangkum oleh: Anggota Komunitas C</p>
                    <p class="text-gray-700 line-clamp-6">
                        Sesuai judulnya, buku ini mengajak kita untuk berhenti sejenak, mengambil napas, dan merenung. Ini adalah pengingat bahwa tidak semua hal harus dikejar dengan tergesa-gesa. Buku yang cocok dibaca saat Anda merasa lelah atau kewalahan, memberikan perspektif tentang penerimaan diri dan emosi.
                    </p>
                    <button class="mt-4 text-teal-600 font-semibold hover:underline">Baca Selengkapnya</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="text-lg font-bold mb-4 text-teal-400">Duduk Baca</h4>
                    <p class="text-sm text-gray-400">Komunitas Literasi Malang. Mari Duduk, Mari Baca.</p>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Navigasi</h4>
                    <ul class="space-y-2">
                        <li><a href="#beranda" class="text-sm text-gray-400 hover:text-white">Beranda</a></li>
                        <li><a href="#tentang" class="text-sm text-gray-400 hover:text-white">Tentang Kami</a></li>
                        <li><a href="#struktur" class="text-sm text-gray-400 hover:text-white">Struktur Komunitas</a></li>
                        <li><a href="#koleksi" class="text-sm text-gray-400 hover:text-white">Koleksi Peminjaman</a></li>
                        <li><a href="#keanggotaan" class="text-sm text-gray-400 hover:text-white">Daftar Bacawan</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Kontak & Kegiatan</h4>
                    <ul class="space-y-2">
                        <li><a id="footer-linktree" href="#" target="_blank" class="text-sm text-gray-400 hover:text-white flex items-center"><i data-lucide="link" class="w-4 h-4 mr-2"></i> Linktree</a></li>
                        <li><a id="footer-sosmed" href="#" target="_blank" class="text-sm text-gray-400 hover:text-white flex items-center"><i data-lucide="instagram" class="w-4 h-4 mr-2"></i> Instagram</a></li>
                        <li><a href="#" target="_blank" class="text-sm text-yellow-400 hover:text-white flex items-center"><i data-lucide="shopping-cart" class="w-4 h-4 mr-2"></i> Kedai Dubi (Merchandise)</a></li>
                        <li><p class="text-sm text-gray-400 flex items-center"><i data-lucide="map-pin" class="w-4 h-4 mr-2"></i> Lapak Alun-Alun Malang</p></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Lisensi & Hak Cipta</h4>
                    <p class="text-sm text-gray-400">&copy; 2025 Duduk Baca. All rights reserved.</p>
                </div>
            </div>
            <div class="mt-10 border-t border-gray-700 pt-6 text-center">
                <p class="text-sm text-gray-500">Dibuat untuk memperluas akses literasi di Malang.</p>
            </div>
        </div>
    </footer>

    <!-- Script Section: Firebase & Logic -->
    <script type="module">
        // --- FIREBASE INITIALIZATION ---
        // Global variables are provided by the Canvas environment
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, where, addDoc, getDocs, setDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: Use setLogLevel to see console output for debugging
        setLogLevel('debug');

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-dudukbaca-app';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth, userId = null;
        let eventsColRef = null; 

        if (firebaseConfig) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            eventsColRef = collection(db, `artifacts/${appId}/public/data/events`); 
            
            // Initial Authentication
            const setupAuth = async () => {
                if (initialAuthToken) {
                    try {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with Custom Token.");
                    } catch (error) {
                        console.error("Custom token sign-in failed. Signing in anonymously.", error);
                        await signInAnonymously(auth);
                    }
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                // Listen for Auth State changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('auth-status').textContent = 'Status: Terautentikasi (Bacawan ID)';
                    } else {
                        // Fallback user ID for unauthenticated state if needed
                        userId = crypto.randomUUID(); 
                        document.getElementById('auth-status').textContent = 'Status: Tidak Terautentikasi (Anonymous ID)';
                    }
                    document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
                    fetchData(); // Start fetching data after auth is ready
                });
            };
            
            setupAuth();

        } else {
            console.error("Firebase config is missing. Data fetching disabled.");
            document.getElementById('user-id-display').textContent = 'User ID: Firebase Not Configured';
            // Use a fallback random ID for UI display purposes if firebase is missing
            userId = crypto.randomUUID(); 
            document.getElementById('user-id-display').textContent = `User ID: ${userId}`;
        }

        // --- GLOBAL UI & NAVIGATION FUNCTIONS ---
        // Menambahkan 'struktur' ke daftar sections
        const sections = ['beranda', 'tentang', 'struktur', 'bukudigital', 'koleksi', 'keanggotaan'];
        
        // Hide all sections and show the target one
        window.showSection = (targetId) => {
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.classList.add('hidden');
                }
            });
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            // Close mobile menu if open
            document.getElementById('mobile-menu').classList.add('hidden');
        };

        // Initialize Lucide Icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            // Attach event listeners for navigation
            document.querySelectorAll('nav a').forEach(link => {
                if (link.href.includes('#')) {
                    link.addEventListener('click', (e) => {
                        const targetId = link.href.split('#')[1];
                        if (sections.includes(targetId)) {
                            e.preventDefault();
                            showSection(targetId);
                        }
                    });
                }
            });
            
            // Mobile menu toggle
            document.getElementById('menu-button').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            // Setup Carousel on DOM load
            initCarousel();

            // Ensure we start at the home screen
            showSection('beranda');
        });

        // Universal Modal Functions
        const showModal = (modalId, title, message, isError = false) => {
            const modal = document.getElementById('notification-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            
            const iconContainer = document.getElementById('modal-icon');
            iconContainer.innerHTML = '';
            
            if (isError) {
                iconContainer.classList.remove('bg-green-100');
                iconContainer.classList.add('bg-red-100');
                iconContainer.innerHTML = '<i data-lucide="x-circle" class="text-red-600 h-6 w-6"></i>';
            } else {
                iconContainer.classList.remove('bg-red-100');
                iconContainer.classList.add('bg-green-100');
                iconContainer.innerHTML = '<i data-lucide="check-circle" class="text-green-600 h-6 w-6"></i>';
            }
            lucide.createIcons();
            modal.classList.remove('hidden');
        };

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if(modal) modal.classList.add('hidden');
        };
        document.getElementById('modal-close-button').onclick = () => closeModal('notification-modal');

        // --- DUMMY/MOCKUP FUNCTIONS ---
        // Mockup Social Media Links
        document.getElementById('linktree-link').href = document.getElementById('mobile-linktree-link').href = document.getElementById('footer-linktree').href = 'https://linktr.ee/dudukbaca';
        document.getElementById('sosmed-link').href = document.getElementById('mobile-sosmed-link').href = document.getElementById('footer-sosmed').href = 'https://instagram.com/dudukbaca_mlg';

        // Mockup Digital Book Fetch (API)
        window.fetchDigitalBooks = () => {
            // Placeholder: Di sini Anda akan memasang logic untuk melakukan
            // fetch ke API buku digital (misalnya Google Books API, dsb.)
            showModal('notification-modal', 'Info API', 'Fungsi API buku digital berhasil dipanggil. Di aplikasi nyata, data e-book akan muncul di sini.');
        };

        // --- CAROUSEL LOGIC ---
        let currentSlide = 0;
        const slidesData = [
            { img: "https://placehold.co/800x600/14b8a6/ffffff?text=Volunteer+Activity+1", caption: "Sesi Diskusi Lapangan Volunteer Batch 7" },
            { img: "https://placehold.co/800x600/0f766e/ffffff?text=Volunteer+Activity+2", caption: "Pengorganisasian Buku Koleksi Komunitas" },
            { img: "https://placehold.co/800x600/0d9488/ffffff?text=Volunteer+Activity+3", caption: "Foto Bersama Volunteer di Lapak Alun-Alun" },
            { img: "https://placehold.co/800x600/042f2e/ffffff?text=Volunteer+Activity+4", caption: "Pelatihan Dasar Penulisan Review Buku" },
        ];

        const initCarousel = () => {
            const carouselContainer = document.getElementById('volunteer-carousel');
            carouselContainer.innerHTML = slidesData.map((slide, index) => `
                <div class="carousel-item absolute inset-0 h-full w-full ${index === 0 ? 'active' : ''}">
                    <img src="${slide.img}" alt="${slide.caption}" class="w-full h-full object-cover">
                    <div class="absolute bottom-0 w-full bg-black/50 text-white p-3 text-sm font-semibold">${slide.caption}</div>
                </div>
            `).join('');
            showSlide(0);
        };

        const showSlide = (n) => {
            const slides = document.querySelectorAll('#volunteer-carousel .carousel-item');
            if (slides.length === 0) return;

            if (n >= slides.length) { currentSlide = 0 } 
            else if (n < 0) { currentSlide = slides.length - 1 }
            else { currentSlide = n }

            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSlide) {
                    slide.classList.add('active');
                }
            });
        };

        window.changeSlide = (n) => {
            showSlide(currentSlide + n);
        };

        // --- FIREBASE DATA FUNCTIONS ---
        const fetchData = () => {
            if (!db || !userId) return;

            // 1. Fetch & Listen to STATS
            const statsRef = doc(db, `artifacts/${appId}/public/data/stats`, "communityStats");
            onSnapshot(statsRef, (docSnap) => {
                if (docSnap.exists()) {
                    const stats = docSnap.data();
                    document.getElementById('stat-borrowings').textContent = stats.totalBorrowings.toLocaleString('id-ID');
                    document.getElementById('stat-members').textContent = stats.totalMembers.toLocaleString('id-ID');
                    document.getElementById('stat-books').textContent = stats.totalBooks.toLocaleString('id-ID');
                    // Menggunakan ID stat-books-koleksi untuk menampilkan juga di section Koleksi
                    const statBooksKoleksi = document.getElementById('stat-books-koleksi');
                    if (statBooksKoleksi) { 
                        statBooksKoleksi.textContent = stats.totalBooks.toLocaleString('id-ID');
                    }
                } else {
                    // Initialize or mock data if not exists
                    setDoc(statsRef, { totalBorrowings: 1250, totalMembers: 450, totalBooks: 800 }, { merge: true }); // Dihapus totalEvents
                }
            }, (error) => {
                console.error("Error fetching stats:", error);
            });

            // 2. Fetch & Listen to EVENTS (Agenda)
            const q = query(eventsColRef); 
            
            onSnapshot(q, (snapshot) => {
                const events = [];
                snapshot.forEach(doc => {
                    events.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort by date (descending)
                events.sort((a, b) => new Date(b.date) - new Date(a.date));

                renderEvents(events);
            }, (error) => {
                console.error("Error fetching events:", error);
            });
        };

        // Render Events into Dashboard Cards
        const renderEvents = (events) => {
            const now = new Date();
            
            const mendatangContainer = document.getElementById('agenda-mendatang');
            const berlaluContainer = document.getElementById('agenda-berlalu');

            mendatangContainer.innerHTML = '';
            berlaluContainer.innerHTML = '';

            const eventsMendatang = events.filter(e => new Date(e.date) >= now);
            const eventsBerlalu = events.filter(e => new Date(e.date) < now);

            // Reverse order for "mendatang" to show the nearest event first
            eventsMendatang.reverse();
            
            eventsMendatang.forEach(event => {
                const eventDateDisplay = new Date(event.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                
                const card = `
                    <div class="p-3 rounded-lg border border-blue-200 bg-blue-50 shadow-sm transition duration-300 hover:shadow-lg flex items-start">
                        <i data-lucide="calendar-check" class="w-5 h-5 text-blue-600 mt-1 mr-3 flex-shrink-0"></i>
                        <div>
                            <p class="text-sm font-bold text-blue-700">${eventDateDisplay}</p>
                            <p class="font-semibold text-gray-800">${event.title}</p>
                            <p class="text-xs text-gray-500 line-clamp-2">${event.location} - ${event.description}</p>
                        </div>
                    </div>
                `;
                mendatangContainer.innerHTML += card;
            });

            eventsBerlalu.forEach(event => {
                const eventDateDisplay = new Date(event.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                
                const card = `
                    <div class="p-3 rounded-lg border border-gray-200 bg-gray-50 shadow-sm transition duration-300 hover:shadow-lg">
                        <div class="flex items-start mb-1">
                             <i data-lucide="check-circle" class="w-5 h-5 text-gray-500 mt-1 mr-3 flex-shrink-0"></i>
                            <div>
                                <p class="text-sm font-bold text-gray-600">${eventDateDisplay}</p>
                                <p class="font-semibold text-gray-800">${event.title}</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 line-clamp-1 mb-2">Lokasi: ${event.location} - ${event.description}</p>
                        ${event.documentationLink ? `<a href="${event.documentationLink}" target="_blank" class="text-xs text-teal-600 font-medium hover:underline flex items-center"><i data-lucide="image" class="w-3 h-3 mr-1"></i> Lihat Dokumentasi</a>` : ''}
                    </div>
                `;
                berlaluContainer.innerHTML += card;
            });

            // Fallback for empty lists
            if (mendatangContainer.innerHTML === '') mendatangContainer.innerHTML = '<p class="p-3 text-gray-500">Belum ada agenda terencana. Lapak Baca rutin setiap Minggu di Alun-Alun Malang.</p>';
            if (berlaluContainer.innerHTML === '') berlaluContainer.innerHTML = '<p class="p-3 text-gray-500">Belum ada riwayat agenda yang tersimpan.</p>';
            
            // Initial mock data if the collection is empty for the first time
            if (events.length === 0 && db) {
                // Tentukan tanggal 02 November (Contoh)
                const nov2nd = new Date(Date.UTC(2025, 10, 2)); // 2 November 2025 (Minggu)
                // Tentukan tanggal minggu sebelumnya (Contoh: 26 Oktober)
                const oct26th = new Date(Date.UTC(2025, 9, 26)); // 26 Oktober 2025 (Minggu)

                const initialEvents = [
                    // Agenda Mendatang (Contoh Minggu 02 November)
                    { 
                        title: "Lapak Baca Mingguan & Diskusi Buku Pilihan", 
                        date: nov2nd.toISOString().split('T')[0], // 2025-11-02
                        location: "Alun-Alun Kota Malang", 
                        description: "Lapak baca rutin. Minggu ini ada sesi singkat bedah buku 'Filosofi Teras'.", 
                        documentationLink: "" 
                    },
                    // Contoh Event Berlalu (Minggu Sebelumnya: 26 Oktober)
                    { 
                        title: "Lapak Baca Mingguan & Perkenalan Bacawan Baru", 
                        date: oct26th.toISOString().split('T')[0], // 2025-10-26
                        location: "Alun-Alun Kota Malang", 
                        description: "Lapak baca rutin. Sambutan hangat untuk anggota Bacawan yang baru bergabung!", 
                        documentationLink: "https://bit.ly/doc-lapak-okt-26" 
                    },
                    // Contoh Event Berlalu dengan Dokumen
                    { 
                        title: "Workshop Content Creator Literasi", 
                        date: "2025-10-15", 
                        location: "Balai Kota", 
                        description: "Pelatihan singkat untuk tim Content Creator divisi Social Media.", 
                        documentationLink: "https://bit.ly/doc-workshop-literasi" 
                    }
                ];

                initialEvents.forEach(event => {
                    addDoc(eventsColRef, event).catch(e => console.error("Error adding initial event:", e));
                });
            }

            lucide.createIcons(); // Re-render icons after adding content
        };

        // --- BOOKING/KEANGGOTAAN LOGIC ---
        
        let currentBookingBook = null;

        window.handleBooking = (bookTitle) => {
            currentBookingBook = bookTitle;
            document.getElementById('booking-book-title').textContent = bookTitle;
            
            // Check authentication status
            const user = auth.currentUser;
            
            // Check if user data exists (simulate successful registration)
            const checkBacawanStatus = async () => {
                if (user && !user.isAnonymous) {
                    const bacawanRef = doc(db, `artifacts/${appId}/public/data/bacawan`, userId);
                    const docSnap = await getDoc(bacawanRef);
                    if (docSnap.exists()) {
                         document.getElementById('booking-user-name').value = docSnap.data().name;
                        document.getElementById('booking-status-unauthenticated').classList.add('hidden');
                        document.getElementById('booking-status-authenticated').classList.remove('hidden');
                    } else {
                        // User is authenticated but hasn't completed registration form
                        document.getElementById('booking-status-unauthenticated').classList.remove('hidden');
                        document.getElementById('booking-status-authenticated').classList.add('hidden');
                    }
                } else {
                    // Not authenticated (Anonymous token)
                    document.getElementById('booking-status-unauthenticated').classList.remove('hidden');
                    document.getElementById('booking-status-authenticated').classList.add('hidden');
                }
            }

            if (db) {
                checkBacawanStatus();
            } else {
                 document.getElementById('booking-status-unauthenticated').classList.remove('hidden');
                 document.getElementById('booking-status-authenticated').classList.add('hidden');
            }


            document.getElementById('booking-modal').classList.remove('hidden');
        };

        window.submitBooking = async () => {
            const pickupDate = document.getElementById('booking-pickup-date').value;
            const userName = document.getElementById('booking-user-name').value;
            
            if (!currentBookingBook || !pickupDate) {
                showModal('notification-modal', 'Error Booking', 'Mohon lengkapi data peminjaman.', true);
                return;
            }
            
            try {
                // Store booking data in the user's private collection
                const bookingRef = collection(db, `artifacts/${appId}/users/${userId}/bookings`);
                await addDoc(bookingRef, {
                    bookTitle: currentBookingBook,
                    userName: userName,
                    pickupDate: pickupDate,
                    bookingDate: new Date().toISOString(),
                    status: 'pending'
                });

                // Update total borrowings stat (optimistically increase by 1)
                const statsRef = doc(db, `artifacts/${appId}/public/data/stats`, "communityStats");
                const statsDoc = await getDoc(statsRef);
                if (statsDoc.exists()) {
                    await updateDoc(statsRef, {
                        totalBorrowings: statsDoc.data().totalBorrowings + 1
                    });
                }

                closeModal('booking-modal');
                showModal('notification-modal', 'Booking Berhasil!', `Buku "${currentBookingBook}" berhasil dibooking untuk diambil pada ${new Date(pickupDate).toLocaleDateString('id-ID')}. Silakan tunjukkan ID Anda.`, false);
                
            } catch (error) {
                console.error("Error submitting booking: ", error);
                showModal('notification-modal', 'Error Booking', 'Gagal menyimpan data booking. Cek koneksi atau status autentikasi.', true);
            }
        };

        // Handle Bacawan Registration
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;

            try {
                // 1. Create a "registered" user profile (Public data for display/lookup)
                const bacawanRef = doc(db, `artifacts/${appId}/public/data/bacawan`, userId);
                const docSnap = await getDoc(bacawanRef);

                if (!docSnap.exists()) {
                    await setDoc(bacawanRef, {
                        name: name,
                        email: email,
                        registrationDate: new Date().toISOString(),
                        role: 'Bacawan'
                    });

                    // 2. Update total members stat ONLY if new registration
                    const statsRef = doc(db, `artifacts/${appId}/public/data/stats`, "communityStats");
                    const statsDoc = await getDoc(statsRef);
                    if (statsDoc.exists()) {
                        await updateDoc(statsRef, {
                            totalMembers: statsDoc.data().totalMembers + 1
                        });
                    }
                    showModal('notification-modal', 'Selamat Datang, Bacawan!', `Pendaftaran berhasil. ID Bacawan Anda adalah ${userId}. Sekarang Anda dapat melakukan booking.`, false);
                } else {
                    // If user exists, just confirm
                    showModal('notification-modal', 'Bacawan Sudah Terdaftar!', `Anda sudah terdaftar sebagai Bacawan dengan ID ${userId}.`, false);
                }
                
                

            } catch (error) {
                console.error("Registration Error: ", error);
                showModal('notification-modal', 'Pendaftaran Gagal', 'Gagal mendaftar. Cek konsol untuk detail error.', true);
            }
        });

    </script>
</body>
</html>
